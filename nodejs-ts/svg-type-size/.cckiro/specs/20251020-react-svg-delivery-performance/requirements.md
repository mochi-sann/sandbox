---
title: requirements
spec: 20251020-react-svg-delivery-performance
status: draft
phase: requirements
---

## 概要

React アプリケーションにおける複数の SVG 配信手法（例: インライン埋め込み、`img` タグ経由、SVGR によるコンポーネント化など）を比較し、同一ディレクトリ内の SVG ファイル群を n 回ずつ表示した際のビルド成果物サイズやリソースサイズを測定できる仕組みを整備する。

## 要件一覧

### 機能要件

- **R-001** SVG アセット登録
  - 説明: 測定対象の SVG ファイルを所定のディレクトリ（例: `assets/svg-samples/`）に複数配置できるようにする。
  - 種別: 機能
  - 受け入れ基準:
    - Given: 任意の SVG ファイルが準備されている
      When: ディレクトリにファイルを追加する
      Then: ビルド・測定フローが追加されたファイルを自動的に認識する

- **R-002** 表示バリエーションの提供
  - 説明: 少なくとも 3 通りの SVG 表示実装（例: インライン JSX、`img` タグ、動的インポートした React コンポーネント）を用意し、同一ページで比較できるようにする。
  - 種別: 機能
  - 受け入れ基準:
    - Given: アプリケーションを起動する
      When: 計測ページにアクセスする
      Then: 3 種類以上の表示方法が並列で確認でき、それぞれが同一 SVG セットを n 回レンダリングする

- **R-003** 表示数の可変制御
  - 説明: SVG を並べる回数 n を設定可能にし、開発者が CLI または設定ファイル経由で変更できるようにする。
  - 種別: 機能
  - 受け入れ基準:
    - Given: 設定値 `n` を 10 から別の値に変更する
      When: ビルドまたは測定コマンドを実行する
      Then: 生成されるページに各 SVG が指定回数レンダリングされ、測定結果も新しい設定値に基づく

- **R-004** サイズ測定スクリプト
  - 説明: 各表示手法に対してビルド成果物のファイルサイズ（JS/CSS/アセット）およびクライアントが取得する静的ファイルサイズを収集し、手法ごとに比較できる。
  - 種別: 機能
  - 受け入れ基準:
    - Given: 測定コマンドを実行する
      When: ビルドが完了する
      Then: 手法ごとのサイズがバイト単位で集計されたレポート（例: JSON + 表示用 Markdown）が生成される

- **R-005** レポート閲覧 UI/出力
  - 説明: 測定結果を CLI 出力およびブラウザ UI の双方で確認できるようにし、各手法の比較指標（総サイズ、1 枚当たり平均サイズ、差分）を提示する。
  - 種別: 機能
  - 受け入れ基準:
    - Given: 測定スクリプトを完了する
      When: CLI 出力またはローカルページを開く
      Then: 手法ごとの差分が視覚的・表形式で確認でき、CSV/JSON 形式でのエクスポートも可能

### 非機能要件

- **R-006** パフォーマンス測定再現性
  - 種別: 非機能（性能）
  - 説明: 同一入力（SVG セットと n）で測定を 3 回繰り返した場合、総サイズのぶれが ±1% 以内に収まる。
  - 受け入れ基準:
    - Given: 同一条件で測定を 3 回実行する
      When: 結果の総サイズを比較する
      Then: 最大値と最小値の差が総サイズの 1% 未満である

- **R-007** セキュリティと依存関係管理
  - 種別: 非機能（セキュリティ）
  - 説明: 測定ツールは追加の外部サービスへデータ送信を行わず、依存ライブラリは最新 LTS メジャーバージョンに固定する。
  - 受け入れ基準:
    - Given: 依存関係をインストールする
      When: `npm audit --production` を実行する
      Then: 重大（critical）および高（high）レベルの脆弱性が検出されない

- **R-008** 観測性と記録
  - 種別: 非機能（可観測性）
  - 説明: 測定実行時のパラメータ（日時、n、SVG ファイル一覧、表示手法のバージョン）をローカルログとして保存する。
  - 受け入れ基準:
    - Given: 測定コマンドを実行する
      When: 結果が生成される
      Then: 設定パラメータと結果メタデータを含むログファイル（例: `reports/history/*.json`）が残る

## 前提条件

- Node.js 18 以上と React 18 を利用できること。
- 既存プロジェクトに測定用ページやスクリプトを追加することを許容する。
- SVG ファイルは著作権的に利用可能であること。

## リスク

- SVG の枚数や n の値が極端に大きい場合、ビルド時間やブラウザレンダリングが著しく遅くなる恐れ。
- ビルドツール（Vite, Webpack など）のキャッシュや最適化が測定結果に影響するリスク。
- ファイル監視やホットリロードによるメモリ使用量増大。

## 想定外/除外事項 (Out of Scope)

- SVG 以外の画像フォーマット（PNG, JPEG 等）の比較。
- ネットワーク CDN 配信やブラウザキャッシュ戦略の最適化。
- 実運用環境での A/B テストやユーザー体感速度の計測。
